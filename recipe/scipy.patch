From a1608ca0d6221943c7f5d3f98c4b2f9a66592b12 Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Sat, 1 Mar 2025 19:26:08 +0100
Subject: [PATCH] Scipy patch (#2)

* Update matdyn2fqha.py

* Update num.py

* Update signal.py

* Update thermo.py

* Update signal.py

* Update pydos.py
---
 bin/matdyn2fqha.py | 4 ++--
 pwtools/num.py     | 5 +++--
 pwtools/pydos.py   | 3 ++-
 pwtools/signal.py  | 5 +++--
 pwtools/thermo.py  | 5 +++--
 5 files changed, 13 insertions(+), 9 deletions(-)

diff --git a/bin/matdyn2fqha.py b/bin/matdyn2fqha.py
index d8d91c59..4823e9a2 100755
--- a/bin/matdyn2fqha.py
+++ b/bin/matdyn2fqha.py
@@ -34,14 +34,14 @@
 
 import sys
 import numpy as np
-from scipy.integrate import simps
+from scipy.integrate import simpson as simps
 
 filename = sys.argv[1]
 arr = np.loadtxt(filename)
 freq = arr[:,0]
 dos = arr[:,1]
 
-integral = simps(dos, freq)
+integral = simps(dos, x=freq)
 
 natom = integral / 3.
 nstep = len(freq)
diff --git a/pwtools/num.py b/pwtools/num.py
index cae61534..59a95492 100644
--- a/pwtools/num.py
+++ b/pwtools/num.py
@@ -6,7 +6,8 @@
 import scipy.optimize as optimize
 from scipy.interpolate import bisplrep, \
     bisplev, splev, splrep
-from scipy.integrate import simps, trapz
+from scipy.integrate import simpson as simps
+from scipy.integrate import cumulative_trapezoid as trapz
 from pwtools import _flib
 import warnings
 ##warnings.simplefilter('always')
@@ -104,7 +105,7 @@ def norm_int(y, x, area=1.0, scale=True, func=simps):
         fx = fy = 1.0
         sx, sy = x, y
     # Area under unscaled y(x).
-    _area = func(sy, sx) * fx * fy
+    _area = func(sy, x=sx) * fx * fy
     return y*area/_area
 
 
diff --git a/pwtools/pydos.py b/pwtools/pydos.py
index ee1ca960..5b00b121 100644
--- a/pwtools/pydos.py
+++ b/pwtools/pydos.py
@@ -15,7 +15,8 @@
 import os, warnings
 import numpy as np
 from scipy.fftpack import fft
-from scipy.signal import convolve, gaussian
+from scipy.signal import convolve
+from scipy.signal.windows import gaussian
 from pwtools import constants, _flib, num
 from pwtools.verbose import verbose
 from pwtools.signal import pad_zeros, welch, mirror
diff --git a/pwtools/signal.py b/pwtools/signal.py
index 3a3af11e..8fe59209 100644
--- a/pwtools/signal.py
+++ b/pwtools/signal.py
@@ -6,8 +6,9 @@
 from itertools import product
 import numpy as np
 from scipy.fftpack import fft, ifft
-from scipy.signal import fftconvolve, gaussian, kaiserord, firwin, lfilter, freqz
-from scipy.integrate import trapz
+from scipy.signal.windows import gaussian
+from scipy.signal import fftconvolve, kaiserord, firwin, lfilter, freqz
+from scipy.integrate import cumulative_trapezoid as trapz
 from pwtools import _flib, num
 
 
diff --git a/pwtools/thermo.py b/pwtools/thermo.py
index a3bdb13b..c5ff0316 100644
--- a/pwtools/thermo.py
+++ b/pwtools/thermo.py
@@ -1,7 +1,8 @@
 """(Quasi)harmonic approximation. Thermal expansion tools."""
 
 import numpy as np
-from scipy.integrate import simps, trapz
+from scipy.integrate import simpson as simps
+from scipy.integrate import cumulative_trapezoid as trapz
 from pwtools.constants import kb, hplanck, R, pi, c0, Ry_to_J, eV,\
     eV_by_Ang3_to_GPa
 from pwtools.verbose import verbose
@@ -151,7 +152,7 @@ def _norm_int(self, y, x, area):
         fy = np.abs(y).max()
         sx = x / fx
         sy = y / fy
-        _area = self.integrator(sy, sx) * fx * fy
+        _area = self.integrator(sy, x=sx) * fx * fy
         return y*area/_area
 
     def _printwarn(self, msg):
